<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Crystal Faire — Party Tracker</title>
  <style>
    :root{
      --bg:#0f0c0a;
      --card:#17120e;
      --ink:#f4efe7;
      --muted:#cbbca7;
      --line:rgba(255,255,255,.14);
      --accent: rgba(42,166,164,.9);
    }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background: radial-gradient(900px 600px at 20% 10%, rgba(255,255,255,.08), transparent 60%),
                  linear-gradient(180deg, #241a12, var(--bg));
      padding: 16px;
    }
    .wrap{max-width:980px;margin:0 auto;}
    h1{margin:0 0 10px;font-size:20px;letter-spacing:.2px}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin: 10px 0 14px;}
    select{
      flex: 1 1 280px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.08);
      color: var(--ink);
      font-weight: 900;
    }
    .card{
      border:1px solid var(--line);
      background: rgba(0,0,0,.22);
      border-radius: 16px;
      padding: 14px;
      box-shadow: 0 12px 28px rgba(0,0,0,.25);
    }
    .name{font-size:22px;font-weight:950;margin:0 0 4px}
    .sub{color:var(--muted);font-weight:800;margin:0 0 12px}
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width:820px){ .grid{grid-template-columns:1fr;} }

    .box{
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      border-radius: 14px;
      padding: 10px 12px;
    }
    .box h3{
      margin:0 0 8px;
      font-size:12px;
      letter-spacing:.4px;
      text-transform:uppercase;
      color:var(--muted);
    }

    .kv{display:flex; justify-content:space-between; gap:10px; padding:6px 0; border-bottom:1px dashed rgba(255,255,255,.10);}
    .kv:last-child{border-bottom:none;}
    .k{color:rgba(244,239,231,.9); font-weight:850;}
    .v{color:rgba(244,239,231,.95); font-weight:950;}

    ul{margin:0; padding-left:18px}
    li{margin:6px 0}

    .muted{color:var(--muted); font-weight:750}

    .inputs{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    @media (max-width:820px){ .inputs{grid-template-columns:1fr;} }

    input[type="number"], textarea{
      width:100%;
      box-sizing:border-box;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      color: var(--ink);
      padding: 10px 12px;
      font-size: 15px;
      outline:none;
    }
    textarea{min-height:110px; resize: vertical;}
    .label{font-weight:900; margin: 0 0 6px; color: rgba(244,239,231,.92)}
    .hpRow{display:flex; gap:10px; align-items:end}
    .hpRow > div{flex:1}
    .pill{
      display:inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-weight: 900;
      color: rgba(244,239,231,.95);
    }
    .slots{display:flex; gap:8px; flex-wrap:wrap; margin-top: 8px;}
    .slot{
      width: 18px; height: 18px;
      border-radius: 6px;
      border: 2px solid var(--accent);
      background: rgba(255,255,255,.12);
      transform: rotate(45deg);
      position: relative;
    }
    .slot input{position:absolute; inset:0; opacity:0;}
    .slot.on{background: var(--accent);}
    .foot{
      margin-top:12px;
      color:rgba(255,255,255,.75);
      font-size:12px;
      line-height:1.35
    }
    button{
      border:1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.08);
      color:#fff;
      border-radius: 12px;
      padding:10px 12px;
      font-weight: 900;
    }
  </style>
</head>
<body>
<div class="wrap">
  <h1>Crystal Faire — Party Tracker</h1>

  <div class="row">
    <select id="pcSelect" aria-label="Select a character"></select>
    <button id="resetThis">Reset This PC (this device)</button>
  </div>

  <div class="card" id="card" hidden>
    <p class="name" id="name"></p>
    <p class="sub" id="sub"></p>

    <div class="grid">
      <div class="box">
        <h3>Core</h3>
        <div class="kv"><div class="k">Level</div><div class="v" id="level"></div></div>
        <div class="kv"><div class="k">Race</div><div class="v" id="race"></div></div>
        <div class="kv"><div class="k">Class</div><div class="v" id="cls"></div></div>
        <div class="kv"><div class="k">AC</div><div class="v" id="ac"></div></div>
        <div class="kv"><div class="k">Speed</div><div class="v" id="speed"></div></div>
        <div class="kv"><div class="k">Init</div><div class="v" id="init"></div></div>
        <div class="kv"><div class="k">Prof</div><div class="v" id="prof"></div></div>
        <div class="kv"><div class="k">Max HP</div><div class="v" id="maxhp"></div></div>

        <div style="margin-top:10px">
          <span class="pill" id="hpPill">HP: —</span>
        </div>
      </div>

      <div class="box">
        <h3>Abilities</h3>
        <div class="kv"><div class="k">STR</div><div class="v" id="str"></div></div>
        <div class="kv"><div class="k">DEX</div><div class="v" id="dex"></div></div>
        <div class="kv"><div class="k">CON</div><div class="v" id="con"></div></div>
        <div class="kv"><div class="k">INT</div><div class="v" id="int"></div></div>
        <div class="kv"><div class="k">WIS</div><div class="v" id="wis"></div></div>
        <div class="kv"><div class="k">CHA</div><div class="v" id="cha"></div></div>
      </div>

      <div class="box">
        <h3>Skills</h3>
        <ul id="skills"></ul>
      </div>

      <div class="box">
        <h3>Saves</h3>
        <ul id="saves"></ul>
      </div>

      <div class="box">
        <h3>Attacks</h3>
        <ul id="attacks"></ul>
      </div>

      <div class="box">
        <h3>Class Feats</h3>
        <ul id="feats"></ul>
      </div>

      <div class="box" id="spellBox" hidden>
        <h3>Spell Slots (tap to use)</h3>
        <div class="muted" id="spellHint"></div>
        <div class="slots" id="slotsL1"></div>
        <div class="slots" id="slotsL2"></div>
      </div>

      <div class="box">
        <h3>Session Tracker</h3>

        <div class="inputs">
          <div>
            <div class="label">Current HP</div>
            <input type="number" id="hpCur" min="0" step="1" />
          </div>

          <div>
            <div class="label">Inventory</div>
            <textarea id="inv" placeholder="Loot, gear, items..."></textarea>
          </div>

          <div>
            <div class="label">Notes</div>
            <textarea id="notes" placeholder="Clues, NPCs, plans..."></textarea>
          </div>

          <div>
            <div class="label">Conditions / Reminders</div>
            <textarea id="conds" placeholder="Poisoned, Exhaustion, Rage uses, Inspiration..."></textarea>
          </div>
        </div>

        <div class="foot">
          Auto-saves on this device.  
          (GitHub Pages cannot save to the server without a backend.)
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // NOTE:
  // These are pulled from the sheets you uploaded in this chat.
  // If a PC is missing here, upload their sheet and I’ll add them.

  const PCS = [
    {
      id:"seris",
      name:"Seris Dawnblade",
      race:"Human",
      cls:"Fighter",
      level:2,
      core:{ ac:16, speed:"30 ft", init:"+1", prof:"+2", maxHp:20 },
      abilities:{ str:"+3", con:"+2", dex:"+1", wis:"+1", int:"+0", cha:"+1" },
      skills:["Athletics +5","Perception +3","Intimidation +3"],
      saves:["Strength +5","Constitution +4"],
      attacks:["Longsword (melee) — To Hit: d20+5 — Damage: 1d8+5"],
      feats:["Second Wind — regain 1d10+2 HP (1/short rest)","Fight Style: Dueling — while using one-handed melee weapon and no other weapons, deal +2 damage","Action Surge — take one extra action (1/short rest)"],
      spells:null
    },
    {
      id:"sable",
      name:"Sable Thornscar",
      race:"Tiefling",
      cls:"Fighter",
      level:2,
      core:{ ac:16, speed:"30 ft", init:"+2", prof:"+2", maxHp:21 },
      abilities:{ str:"+3", con:"+2", dex:"+2", wis:"+0", int:"+0", cha:"+1" },
      skills:["Intimidation +3","Athletics +5","Perception +2"],
      saves:["Strength +5","Constitution +4"],
      attacks:[
        "Greatsword (melee) — To Hit: d20+5 — Damage: 2d6+3",
        "Handaxe (20/60) — To Hit: d20+5 — Damage: 1d6+3"
      ],
      feats:[
        "Second Wind — regain 1d10+2 HP (1/short rest)",
        "Fight Style: Great Weapon Fighting — when you roll a 1 or 2 on damage dice, reroll and use the new result",
        "Action Surge — take one extra action (1/short rest)"
      ],
      spells:null
    },
    {
      id:"korrin",
      name:"Korrin Ashfang",
      race:"Half-Orc",
      cls:"Rogue",
      level:2,
      core:{ ac:14, speed:"30 ft", init:"+3", prof:"+2", maxHp:18 },
      abilities:{ str:"+2", con:"+2", dex:"+3", wis:"+1", int:"+0", cha:"+0" },
      skills:["Stealth +5","Perception +3","Acrobatics +5"],
      saves:["Dexterity +5","Intelligence +2"],
      attacks:[
        "Shortsword (melee) — To Hit: d20+5 — Damage: 1d6+3",
        "Shortbow (80/320) — To Hit: d20+5 — Damage: 1d6+3"
      ],
      feats:[
        "Sneak Attack (1/turn) — if you have advantage OR an ally is next to target, deal +1d6 damage",
        "Cunning Action — Dash, Disengage, or Hide as a bonus action"
      ],
      spells:null
    },
    {
      id:"haldor",
      name:"Haldor Brightshield",
      race:"Dwarf",
      cls:"Cleric (Life Domain)",
      level:2,
      core:{ ac:18, speed:"25 ft", init:"+0", prof:"+2", maxHp:18 },
      abilities:{ str:"+2", con:"+3", dex:"+0", wis:"+3", int:"+0", cha:"+1" },
      skills:["Medicine +5","Perception +5","Insight +5"],
      saves:["Wisdom +5","Charisma +3"],
      attacks:[
        "Warhammer (melee) — To Hit: d20+4 — Damage: 1d8+2",
        "Light Xbow (80/320) — To Hit: d20+2 — Damage: 1d8"
      ],
      feats:[
        "Disciple of Life — when you cast a healing spell, restore extra HP (2 + spell level)",
        "Channel Divinity (1/short rest): Turn Undead (WIS save) OR Preserve Life (split 10 HP within 30 ft)",
        "Spellcasting (Lvl 2)"
      ],
      spells:{ l1:2, l2:1 }
    },
    {
      id:"ashara",
      name:"Ashara Solkindle",
      race:"Fire Genasi",
      cls:"Cleric (Life Domain)",
      level:2,
      core:{ ac:16, speed:"30 ft", init:"+0", prof:"+2", maxHp:18 },
      abilities:{ str:"+1", con:"+2", dex:"+1", wis:"+3", int:"+0", cha:"+1" },
      skills:["Medicine +5","Perception +5","Insight +5"],
      saves:["Wisdom +5","Charisma +3"],
      attacks:["Staff (melee) — To Hit: d20+3 — Damage: 1d8+1"],
      feats:[
        "Disciple of Life — when you cast a healing spell, restore extra HP (2 + spell level)",
        "Channel Divinity (1/short rest): Turn Undead (WIS save) OR Preserve Life (split 10 HP within 30 ft)",
        "Warm Hands (1/short rest) — touch a creature to end shivering/fear",
        "Spellcasting (Lvl 2)"
      ],
      spells:{ l1:2, l2:1 }
    },
    {
      id:"edrin",
      name:"Edrin Valebright",
      race:"Human",
      cls:"Paladin",
      level:2,
      core:{ ac:19, speed:"30 ft", init:"+0", prof:"+2", maxHp:20 },
      abilities:{ str:"+3", con:"+2", dex:"+0", wis:"+1", int:"+0", cha:"+2" },
      skills:["Athletics +5","Persuasion +4","Insight +3"],
      saves:["Wisdom +3","Charisma +4"],
      attacks:["Longsword (melee) — To Hit: d20+5 — Damage: 1d8+3"],
      feats:[
        "Lay on Hands — heal from a pool of 10 HP / long rest",
        "Divine Smite — spend a spell slot when you hit to deal +2d8 radiant (+1d8 vs undead/fiends)",
        "Defense (Fighting Style) — while wearing armor, AC +1 (already added)",
        "Spellcasting (see page 2)"
      ],
      spells:{ l1:2, l2:0 }
    },
    {
      id:"rurik",
      name:"Rurik Goldnote",
      race:"Dwarf",
      cls:"Bard",
      level:2,
      core:{ ac:14, speed:"25 ft", init:"+1", prof:"+2", maxHp:17 },
      abilities:{ str:"+1", con:"+2", dex:"+1", wis:"+0", int:"+1", cha:"+3" },
      skills:["Persuasion +5","Performance +5","History +3"],
      saves:["Dexterity +3","Charisma +5"],
      attacks:[
        "Rapier (melee) — To Hit: d20+3 — Damage: 1d8+1",
        "Dagger (20/60) — To Hit: d20+3 — Damage: 1d4+1"
      ],
      feats:[
        "Bardic Inspiration — bonus action, 3/day: give an ally a d6 to add to an attack/save/check",
        "Jack of All Trades — add +1 to any ability check you aren’t proficient in",
        "Song of Rest (d6) — during a short rest, allies heal +1d6 extra",
        "Spellcasting (Lvl 2)"
      ],
      spells:{ l1:2, l2:1 }
    },
    {
      id:"lark",
      name:"Lark Thistledown",
      race:"Halfling",
      cls:"Bard",
      level:2,
      core:{ ac:14, speed:"25 ft", init:"+3", prof:"+2", maxHp:15 },
      abilities:{ str:"-1", con:"+1", dex:"+3", wis:"+1", int:"+0", cha:"+3" },
      skills:["Deception +5","Stealth +5","Perception +3"],
      saves:["Dexterity +5","Charisma +5"],
      attacks:[
        "Rapier (melee) — To Hit: d20+5 — Damage: 1d8+3",
        "Dagger (20/60) — To Hit: d20+5 — Damage: 1d4+3"
      ],
      feats:[
        "Bardic Inspiration — bonus action, 3/day: give an ally a d6 to add to an attack/save/check",
        "Jack of All Trades — add +1 to any ability check you aren’t proficient in",
        "Song of Rest (d6) — during a short rest, allies heal +1d6 extra",
        "Spellcasting (Lvl 2)"
      ],
      spells:{ l1:2, l2:1 }
    },
    {
      id:"liora",
      name:"Liora Windstep",
      race:"Wood Elf",
      cls:"Ranger",
      level:2,
      core:{ ac:15, speed:"30 ft", init:"+3", prof:"+2", maxHp:19 },
      abilities:{ str:"+1", con:"+1", dex:"+3", wis:"+2", int:"+0", cha:"+0" },
      skills:["Stealth +5","Perception +4","Survival +4"],
      saves:["Strength +3","Dexterity +5"],
      attacks:[
        "Longbow (150/600) — To Hit: d20+5 — Damage: 1d8+3",
        "Shortsword (melee) — To Hit: d20+5 — Damage: 1d6+3"
      ],
      feats:[
        "Fav Enemy: Undead — advantage on tracking + recalling info about undead",
        "Natural Explorer — Coastal/Forest: ignore difficult terrain and never get lost",
        "Spellcasting (Lvl 2)"
      ],
      spells:{ l1:2, l2:0 }
    },
    {
      id:"azrael",
      name:"Azrael Cinderborn",
      race:"Tiefling",
      cls:"Barbarian",
      level:2,
      core:{ ac:15, speed:"30 ft", init:"+2", prof:"+2", maxHp:25 },
      abilities:{ str:"+4", con:"+3", dex:"+2", wis:"+0", int:"-1", cha:"+1" },
      skills:["Intimidation +3","Athletics +6","Survival +2"],
      saves:["Strength +6","Constitution +5"],
      attacks:[
        "Spear (20/60) — To Hit: d20+6 — Damage: 1d8+4",
        "Javelin (30/120) — To Hit: d20+6 — Damage: 1d6+4"
      ],
      feats:[
        "Rage (2/long rest) — bonus action, 1 min: +2 dmg on STR attacks, adv on STR checks+saves, resist B/P/S",
        "Reckless Attack — on your first attack each turn, gain advantage; enemies have advantage to hit you until next turn",
        "Danger Sense — advantage on DEX saves vs effects you can see"
      ],
      spells:null
    }
  ];

  const select = document.getElementById("pcSelect");
  const card = document.getElementById("card");

  const el = (id)=>document.getElementById(id);

  const hpCur = el("hpCur");
  const inv = el("inv");
  const notes = el("notes");
  const conds = el("conds");

  const spellBox = el("spellBox");
  const spellHint = el("spellHint");
  const slotsL1 = el("slotsL1");
  const slotsL2 = el("slotsL2");

  let currentPcId = null;

  function keyFor(pcId){ return `tracker::${pcId}`; }

  function populate(){
    select.innerHTML = "";
    PCS.forEach(pc=>{
      const o = document.createElement("option");
      o.value = pc.id;
      o.textContent = pc.name;
      select.appendChild(o);
    });

    const last = localStorage.getItem("party_tracker_last_pc");
    const firstId = PCS[0]?.id;
    select.value = PCS.some(p=>p.id===last) ? last : firstId;
    render(select.value);
  }

  function setList(listElId, items){
    const ul = el(listElId);
    ul.innerHTML = "";
    (items || []).forEach(t=>{
      const li = document.createElement("li");
      li.textContent = t;
      ul.appendChild(li);
    });
  }

  function renderSlots(container, pcId, levelKey, count){
    container.innerHTML = "";
    if(!count || count <= 0) return;

    for(let i=0;i<count;i++){
      const wrap = document.createElement("div");
      wrap.className = "slot";
      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.dataset.slot = `${levelKey}:${i}`;
      cb.addEventListener("change", save);
      wrap.appendChild(cb);
      container.appendChild(wrap);
    }
  }

  function syncSlotVisuals(){
    document.querySelectorAll(".slot").forEach(s=>{
      const cb = s.querySelector("input");
      s.classList.toggle("on", !!cb.checked);
    });
  }

  function load(){
    if(!currentPcId) return;
    const raw = localStorage.getItem(keyFor(currentPcId));
    if(!raw){
      // default HP = max HP
      const pc = PCS.find(p=>p.id===currentPcId);
      hpCur.value = pc?.core?.maxHp ?? "";
      inv.value = "";
      notes.value = "";
      conds.value = "";
      document.querySelectorAll(".slot input").forEach(cb=>cb.checked=false);
      syncSlotVisuals();
      updateHpPill();
      return;
    }

    try{
      const st = JSON.parse(raw);
      hpCur.value = st.hpCur ?? "";
      inv.value = st.inv ?? "";
      notes.value = st.notes ?? "";
      conds.value = st.conds ?? "";

      // restore slots
      const slotState = st.slots || {};
      document.querySelectorAll(".slot input").forEach(cb=>{
        cb.checked = !!slotState[cb.dataset.slot];
      });

      syncSlotVisuals();
      updateHpPill();
    }catch{
      // ignore
    }
  }

  function save(){
    if(!currentPcId) return;
    const slotState = {};
    document.querySelectorAll(".slot input").forEach(cb=>{
      slotState[cb.dataset.slot] = !!cb.checked;
    });

    const st = {
      hpCur: hpCur.value,
      inv: inv.value,
      notes: notes.value,
      conds: conds.value,
      slots: slotState
    };

    localStorage.setItem(keyFor(currentPcId), JSON.stringify(st));
    syncSlotVisuals();
    updateHpPill();
  }

  function updateHpPill(){
    const pc = PCS.find(p=>p.id===currentPcId);
    const maxHp = pc?.core?.maxHp ?? "—";
    const cur = hpCur.value || "—";
    el("hpPill").textContent = `HP: ${cur} / ${maxHp}`;
  }

  function render(id){
    const pc = PCS.find(p=>p.id===id);
    if(!pc) return;

    currentPcId = id;
    localStorage.setItem("party_tracker_last_pc", id);

    card.hidden = false;

    el("name").textContent = pc.name;
    el("sub").textContent = `${pc.race} • ${pc.cls}`;

    el("level").textContent = pc.level ?? "—";
    el("race").textContent  = pc.race ?? "—";
    el("cls").textContent   = pc.cls ?? "—";

    el("ac").textContent    = pc.core?.ac ?? "—";
    el("speed").textContent = pc.core?.speed ?? "—";
    el("init").textContent  = pc.core?.init ?? "—";
    el("prof").textContent  = pc.core?.prof ?? "—";
    el("maxhp").textContent = pc.core?.maxHp ?? "—";

    el("str").textContent = pc.abilities?.str ?? "—";
    el("dex").textContent = pc.abilities?.dex ?? "—";
    el("con").textContent = pc.abilities?.con ?? "—";
    el("int").textContent = pc.abilities?.int ?? "—";
    el("wis").textContent = pc.abilities?.wis ?? "—";
    el("cha").textContent = pc.abilities?.cha ?? "—";

    setList("skills", pc.skills);
    setList("saves", pc.saves);
    setList("attacks", pc.attacks);
    setList("feats", pc.feats);

    // spell slots
    if(pc.spells){
      spellBox.hidden = false;
      const l1 = pc.spells.l1 || 0;
      const l2 = pc.spells.l2 || 0;
      spellHint.textContent = `Level 1: ${l1} slot(s) • Level 2: ${l2} slot(s)`;
      renderSlots(slotsL1, pc.id, "L1", l1);
      renderSlots(slotsL2, pc.id, "L2", l2);
    }else{
      spellBox.hidden = true;
      slotsL1.innerHTML = "";
      slotsL2.innerHTML = "";
    }

    load();
  }

  select.addEventListener("change", () => render(select.value));
  [hpCur, inv, notes, conds].forEach(x => x.addEventListener("input", save));

  document.getElementById("resetThis").addEventListener("click", ()=>{
    if(!currentPcId) return;
    if(confirm("Reset this PC on THIS device?")){
      localStorage.removeItem(keyFor(currentPcId));
      render(currentPcId);
    }
  });

  populate();
</script>
</body>
</html>
